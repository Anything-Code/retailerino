(()=>{"use strict";var e={523:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createContext=t.pc=void 0;const n=r(524);t.pc=new n.PrismaClient,t.createContext=({req:e,res:r})=>({req:e,res:r,pc:t.pc,playground:{settings:{"request.credentials":"include"}}})},607:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(871)),s=n(r(860)),i=n(r(508)),a=r(55),u=r(950),l=n(r(142)),c=r(523),p=n(r(991));l.default.config();const d=(0,o.default)(i.default),y=(0,s.default)();y.use(p.default.express()),y.use((0,i.default)({store:new d({db:"./prisma/db.db",concurrentDB:!0}),name:"qid",secret:process.env.SESSION_SECRET||"secret",resave:!1,saveUninitialized:!1,cookie:{sameSite:"lax",httpOnly:!0,secure:!1,maxAge:220752e6}})),async function(e,t){await t.start(),t.applyMiddleware({app:e,cors:{origin:!0,credentials:!0}});const r=process.env.PORT||4e3;e.listen(r,(()=>{console.log(`Server started at http://localhost:${r}/graphql`)}))}(y,new a.ApolloServer({schema:u.schema,context:e=>(0,c.createContext)(e)}))},489:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isAuthenticated=t.isAuthenticatedRuleType=void 0;const n=r(259);t.isAuthenticatedRuleType=(0,n.ruleType)({resolve:(e,t,{req:r})=>!!r.session.authenticated}),t.isAuthenticated={shield:t.isAuthenticatedRuleType}},950:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.schema=void 0;const a=r(854),u=r(259),l=r(292),c=i(r(650)),p=s(r(218)),d=r(822);t.schema=(0,a.makeSchema)({types:{...c.default,...p},plugins:[(0,u.nexusShield)({defaultError:new l.ForbiddenError("Not allowed"),defaultRule:u.allow})],outputs:{typegen:(0,d.join)(process.cwd(),"generated","typegen.d.ts"),schema:(0,d.join)(process.cwd(),"generated","schema.graphql")},contextType:{module:523,export:"Context"},sourceTypes:{modules:[{module:917,alias:"prisma"}]}})},93:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteMyself=t.updateMyself=t.me=t.logout=t.login=t.register=t.orderItemObjectType=t.categoryObjectType=t.imageObjectType=t.deliveryServiceProviderObjectType=t.inventoryGroupCategoryObjectType=t.inventoryGroupImageObjectType=t.inventoryGroupRealtionshipObjectType=t.inventoryItemObjectType=t.inventoryGroupObjectType=t.reviewObjectType=t.orderObjectType=t.addressObjectType=t.cartObjectType=t.roleObjectType=t.userObjectType=void 0;const o=r(572),s=r(854),i=r(17),a=n(r(96)),u=r(292),l=r(489);function c(e,t){const r={name:e.$name,definition(r){!function(e,t,r){Object.keys(t).filter((e=>!e.includes("$"))).filter((e=>!(null==r?void 0:r.includes(e)))).forEach((r=>{e.field(t[r])}))}(r,e,t)}};return e.$description?{...r,description:e.$description}:r}t.userObjectType=(0,s.objectType)(c(i.User,(0,o.List)(["password"]))),t.roleObjectType=(0,s.objectType)(c(i.Role)),t.cartObjectType=(0,s.objectType)(c(i.CartItem)),t.addressObjectType=(0,s.objectType)(c(i.Address)),t.orderObjectType=(0,s.objectType)(c(i.Order)),t.reviewObjectType=(0,s.objectType)(c(i.Review)),t.inventoryGroupObjectType=(0,s.objectType)(c(i.InventoryGroup)),t.inventoryItemObjectType=(0,s.objectType)(c(i.InventoryItem)),t.inventoryGroupRealtionshipObjectType=(0,s.objectType)(c(i.InventoryGroupRelationship)),t.inventoryGroupImageObjectType=(0,s.objectType)(c(i.InventoryGroupImage)),t.inventoryGroupCategoryObjectType=(0,s.objectType)(c(i.InventoryGroupCategory)),t.deliveryServiceProviderObjectType=(0,s.objectType)(c(i.DeliveryServiceProvider)),t.imageObjectType=(0,s.objectType)(c(i.Image)),t.categoryObjectType=(0,s.objectType)(c(i.Category)),t.orderItemObjectType=(0,s.objectType)(c(i.OrderItem));const p={addresses:!0,cartItems:!0,orders:!0,reviews:!0,role:!0};t.register=(0,s.mutationField)("register",{type:i.User.$name,args:{email:(0,s.nonNull)("String"),password:(0,s.nonNull)("String"),firstname:(0,s.nonNull)("String"),lastname:(0,s.nonNull)("String"),phoneNumber:(0,s.nonNull)("String")},description:"Registers a new user.",async resolve(e,{email:t,password:r,firstname:n,lastname:o,phoneNumber:s},{req:i,pc:u}){var l;const c=await a.default.genSalt(10),d=await a.default.hash(r,c),y=await u.user.create({data:{email:t,password:d,firstname:n,lastname:o,phoneNumber:s,lastUserAgent:null===(l=i.useragent)||void 0===l?void 0:l.source,role:{connect:{id:2}}},include:p});return i.session.authenticated=!0,i.session.user=y,y}}),t.login=(0,s.mutationField)("login",{type:i.User.$name,args:{email:(0,s.nonNull)("String"),password:(0,s.nonNull)("String")},description:"Logs a user in",async resolve(e,{email:t,password:r},{req:n,pc:o}){const s=await o.user.findUnique({where:{email:t},include:p});if(null==s)throw u.AuthenticationError;if(!await a.default.compare(r,s.password))throw u.AuthenticationError;return n.session.authenticated=!0,n.session.user=s,console.log(n.session),s}}),t.logout=(0,s.mutationField)("logout",{type:"Boolean",shield:l.isAuthenticatedRuleType,resolve:(e,t,{req:r,res:n})=>(n.clearCookie("qid"),!0)}),t.me=(0,s.mutationField)("me",{type:i.User.$name,shield:l.isAuthenticatedRuleType,resolve:(e,t,{req:r})=>r.session.user}),t.updateMyself=(0,s.mutationField)("updateMyself",{type:i.User.$name,args:{email:(0,s.nonNull)("String"),password:(0,s.nonNull)("String"),firstname:(0,s.nonNull)("String"),lastname:(0,s.nonNull)("String"),phonenumber:(0,s.nonNull)("String")},shield:l.isAuthenticatedRuleType,async resolve(e,{email:t,password:r,firstname:n,lastname:o,phoneNumber:s},{req:i,pc:a}){const u=await a.user.findFirst({where:{cuid:i.session.user.cuid}});return await a.user.update({where:{cuid:i.session.user.cuid},data:{email:null!=t?t:u.email,password:null!=r?r:u.password,firstname:null!=n?n:u.firstname,lastname:null!=o?o:u.lastname,phoneNumber:null!=s?s:u.phoneNumber}})}}),t.deleteMyself=(0,s.mutationField)("deleteMyself",{type:"Boolean",args:{confirm:(0,s.nonNull)("Boolean")},shield:l.isAuthenticatedRuleType,resolve:async(e,{confirm:t},{req:r,res:n,pc:o})=>(await o.user.delete({where:{cuid:r.session.user.cuid}}),n.clearCookie("qid"),!0)})},218:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0,t.User=s(r(93))},917:e=>{e.exports=require(".prisma/client/index.d.ts")},524:e=>{e.exports=require("@prisma/client")},292:e=>{e.exports=require("apollo-server-errors")},55:e=>{e.exports=require("apollo-server-express")},96:e=>{e.exports=require("bcrypt")},871:e=>{e.exports=require("connect-sqlite3")},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},508:e=>{e.exports=require("express-session")},991:e=>{e.exports=require("express-useragent")},572:e=>{e.exports=require("immutable")},854:e=>{e.exports=require("nexus")},17:e=>{e.exports=require("nexus-prisma")},650:e=>{e.exports=require("nexus-prisma/scalars")},259:e=>{e.exports=require("nexus-shield")},822:e=>{e.exports=require("path")}},t={},r=function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,r),s.exports}(607),n=exports;for(var o in r)n[o]=r[o];r.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();