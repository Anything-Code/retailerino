(()=>{"use strict";var e={523:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createContext=t.pc=void 0;const s=r(524);t.pc=new s.PrismaClient,t.createContext=({req:e,res:r})=>({req:e,res:r,pc:t.pc,prisma:t.pc,playground:{settings:{"request.credentials":"include"}}})},607:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(r(871)),i=s(r(860)),o=s(r(508)),a=r(55),l=r(950),u=s(r(142)),c=r(523),p=s(r(991));u.default.config();const d=(0,n.default)(o.default),y=(0,i.default)();y.use(p.default.express()),y.use((0,o.default)({store:new d({db:"./prisma/db.db",concurrentDB:!0}),name:"qid",secret:process.env.SESSION_SECRET||"secret",resave:!1,saveUninitialized:!1,cookie:{sameSite:"lax",httpOnly:!0,secure:!1,maxAge:220752e6}})),async function(e,t){await t.start(),t.applyMiddleware({app:e,cors:{origin:!0,credentials:!0}});const r=process.env.PORT||4e3;e.listen(r,(()=>{console.log(`Server started at http://localhost:${r}/graphql`)}))}(y,new a.ApolloServer({schema:l.schema,context:e=>(0,c.createContext)(e)}))},489:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isAuthenticated=t.isAdmin=t.isUser=t.isAuthenticatedRuleType=t.isAdminRuleType=t.isUserRuleType=void 0;const s=r(259);t.isUserRuleType=(0,s.ruleType)({resolve:(e,t,{req:r})=>"user"===r.session.user.role.name}),t.isAdminRuleType=(0,s.ruleType)({resolve:(e,t,{req:r})=>"admin"===r.session.user.role.name}),t.isAuthenticatedRuleType=(0,s.or)(t.isUserRuleType,t.isAdminRuleType),t.isUser={shield:t.isUserRuleType},t.isAdmin={shield:t.isAdminRuleType},t.isAuthenticated={shield:(0,s.or)(t.isUserRuleType,t.isAdminRuleType)}},950:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.schema=void 0;const a=r(854),l=r(259),u=r(292),c=o(r(650)),p=r(17),d=i(r(218));t.schema=(0,a.makeSchema)({types:{...c.default,...d},plugins:[(0,l.nexusShield)({defaultError:new u.ForbiddenError("Not allowed"),defaultRule:l.allow})],outputs:{typegen:(0,p.join)(process.cwd(),"node_modules","@types","nexus-typegen","index.d.ts"),schema:(0,p.join)(process.cwd(),"generated","schema.graphql")},contextType:{module:523,export:"Context"},sourceTypes:{modules:[{module:917,alias:"prisma"}]}})},93:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.changeRole=t.deleteMyself=t.updateMyself=t.me=t.logout=t.login=t.register=t.orderItemObjectType=t.categoryObjectType=t.imageObjectType=t.deliveryServiceProviderObjectType=t.inventoryGroupCategoryObjectType=t.inventoryGroupImageObjectType=t.inventoryGroupRealtionshipObjectType=t.inventoryItemObjectType=t.inventoryGroupObjectType=t.reviewObjectType=t.orderObjectType=t.addressObjectType=t.cartObjectType=t.roleObjectType=t.userObjectType=t.salt=void 0;const n=r(854),i=r(901),o=r(292),a=r(489),l=r(572),u=s(r(96));function c(e,t){const r={name:e.$name,definition(r){!function(e,t,r){Object.keys(t).filter((e=>!e.includes("$"))).filter((e=>!(null==r?void 0:r.includes(e)))).forEach((r=>{e.field(t[r])}))}(r,e,t)}};return e.$description?{...r,description:e.$description}:r}t.salt=async()=>await u.default.genSalt(10),t.userObjectType=(0,n.objectType)(c(i.User,(0,l.List)(["password"]))),t.roleObjectType=(0,n.objectType)(c(i.Role)),t.cartObjectType=(0,n.objectType)(c(i.CartItem)),t.addressObjectType=(0,n.objectType)(c(i.Address)),t.orderObjectType=(0,n.objectType)(c(i.OrderI)),t.reviewObjectType=(0,n.objectType)(c(i.Review)),t.inventoryGroupObjectType=(0,n.objectType)(c(i.InventoryGroup)),t.inventoryItemObjectType=(0,n.objectType)(c(i.InventoryItem)),t.inventoryGroupRealtionshipObjectType=(0,n.objectType)(c(i.InventoryGroupRelationship)),t.inventoryGroupImageObjectType=(0,n.objectType)(c(i.InventoryGroupImage)),t.inventoryGroupCategoryObjectType=(0,n.objectType)(c(i.InventoryGroupCategory)),t.deliveryServiceProviderObjectType=(0,n.objectType)(c(i.DeliveryServiceProvider)),t.imageObjectType=(0,n.objectType)(c(i.Image)),t.categoryObjectType=(0,n.objectType)(c(i.Category)),t.orderItemObjectType=(0,n.objectType)(c(i.OrderItem));const p={addresses:!0,cartItems:!0,orders:!0,reviews:!0,role:!0};t.register=(0,n.mutationField)("register",{type:i.User.$name,args:{email:(0,n.nonNull)("String"),password:(0,n.nonNull)("String"),firstname:(0,n.nonNull)("String"),lastname:(0,n.nonNull)("String"),phoneNumber:(0,n.nonNull)("String")},description:"Registers a new user.",async resolve(e,{email:r,password:s,firstname:n,lastname:i,phoneNumber:o},{req:a,pc:l}){var c;const d=await u.default.hash(s,await(0,t.salt)()),y=await l.user.create({data:{email:r,password:d,firstname:n,lastname:i,phoneNumber:o,lastUserAgent:null===(c=a.useragent)||void 0===c?void 0:c.source,role:{connect:{id:2}}},include:p});return a.session.user=y,y}}),t.login=(0,n.mutationField)("login",{type:i.User.$name,args:{email:(0,n.nonNull)("String"),password:(0,n.nonNull)("String")},description:"Logs a user in",async resolve(e,{email:t,password:r},{req:s,pc:n}){const i=await n.user.findUnique({where:{email:t},include:p});if(null==i)throw o.AuthenticationError;if(!await u.default.compare(r,i.password))throw o.AuthenticationError;return s.session.user=i,i}}),t.logout=(0,n.mutationField)("logout",{type:"Boolean",shield:a.isAuthenticatedRuleType,resolve:(e,t,{req:r,res:s})=>(s.clearCookie("qid"),!0)}),t.me=(0,n.mutationField)("me",{type:i.User.$name,shield:a.isAuthenticatedRuleType,resolve:(e,t,{req:r})=>r.session.user}),t.updateMyself=(0,n.mutationField)("updateMyself",{type:i.User.$name,args:{email:(0,n.nonNull)("String"),password:(0,n.nonNull)("String"),firstname:(0,n.nonNull)("String"),lastname:(0,n.nonNull)("String"),phonenumber:(0,n.nonNull)("String")},shield:a.isAuthenticatedRuleType,async resolve(e,{email:t,password:r,firstname:s,lastname:n,phoneNumber:i},{req:o,pc:a}){const l=await a.user.findFirst({where:{cuid:o.session.user.cuid}});return await a.user.update({where:{cuid:o.session.user.cuid},data:{email:null!=t?t:l.email,password:null!=r?r:l.password,firstname:null!=s?s:l.firstname,lastname:null!=n?n:l.lastname,phoneNumber:null!=i?i:l.phoneNumber}})}}),t.deleteMyself=(0,n.mutationField)("deleteMyself",{type:"Boolean",args:{confirm:(0,n.nonNull)("Boolean")},shield:a.isAuthenticatedRuleType,resolve:async(e,{confirm:t},{req:r,res:s,pc:n})=>(await n.user.delete({where:{cuid:r.session.user.cuid}}),s.clearCookie("qid"),!0)}),t.changeRole=(0,n.mutationField)("changeRole",{type:i.User.$name,args:{user:(0,n.nonNull)("String"),role:(0,n.nonNull)("Int")},shield:a.isAdminRuleType,async resolve(e,{user:t,role:r},{pc:s,req:n}){if("admin"===n.session.user.role.name)throw"Don't go back to moke!";return await s.user.update({where:{cuid:t},data:{role:{connect:{id:r}}}})}})},218:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0,t.User=i(r(93))},917:e=>{e.exports=require(".prisma/client/index.d.ts")},524:e=>{e.exports=require("@prisma/client")},292:e=>{e.exports=require("apollo-server-errors")},55:e=>{e.exports=require("apollo-server-express")},96:e=>{e.exports=require("bcrypt")},871:e=>{e.exports=require("connect-sqlite3")},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},508:e=>{e.exports=require("express-session")},991:e=>{e.exports=require("express-useragent")},572:e=>{e.exports=require("immutable")},854:e=>{e.exports=require("nexus")},901:e=>{e.exports=require("nexus-prisma")},650:e=>{e.exports=require("nexus-prisma/scalars")},259:e=>{e.exports=require("nexus-shield")},17:e=>{e.exports=require("path")}},t={},r=function r(s){var n=t[s];if(void 0!==n)return n.exports;var i=t[s]={exports:{}};return e[s].call(i.exports,i,i.exports,r),i.exports}(607),s=exports;for(var n in r)s[n]=r[n];r.__esModule&&Object.defineProperty(s,"__esModule",{value:!0})})();